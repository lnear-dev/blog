<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar data-theme="dark" class="astro-z2rwgm2f"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>RAII in PHP: Managing Resources Elegantly | Blog</title><link rel="canonical" href="https://blog.lnear.dev/raii-in-php/"/><link rel="sitemap" href="/sitemap-index.xml"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.11.5"/><meta name="generator" content="Starlight v0.24.5"/><meta property="og:title" content="RAII in PHP: Managing Resources Elegantly"/><meta property="og:type" content="article"/><meta property="og:url" content="https://blog.lnear.dev/raii-in-php/"/><meta property="og:locale" content="en"/><meta property="og:description" content="Learn how to apply Resource Acquisition Is Initialization (RAII) principles in PHP for efficient resource management. Discover the benefits of RAII-like patterns and how they can elevate your code quality."/><meta property="og:site_name" content="Blog"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="RAII in PHP: Managing Resources Elegantly"/><meta name="twitter:description" content="Learn how to apply Resource Acquisition Is Initialization (RAII) principles in PHP for efficient resource management. Discover the benefits of RAII-like patterns and how they can elevate your code quality."/><meta name="description" content="Learn how to apply Resource Acquisition Is Initialization (RAII) principles in PHP for efficient resource management. Discover the benefits of RAII-like patterns and how they can elevate your code quality."/><meta name="twitter:site" content="/lnearwaju"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.IXkl0Q_7.css">
<link rel="stylesheet" href="/_astro/index.DXlJNvtb.css"><script type="module" src="/_astro/hoisted.kgFex_yz.js"></script>
<script type="module" src="/_astro/page.LS5KDvwX.js"></script></head> <body class="astro-z2rwgm2f"> <a href="#_top" class="astro-qf4zdiqj">Skip to content</a>  <div class="page sl-flex astro-hktxvhte"> <header class="header astro-hktxvhte"><div class="header sl-flex astro-3yejb74e"> <div class="title-wrapper sl-flex astro-3yejb74e"> <a href="/" class="site-title sl-flex astro-dtgod6zf">  <img class="astro-dtgod6zf" alt="" src="/_astro/logo.BCG1Nb5R.svg" width="2000" height="2000">  <span class="astro-dtgod6zf"> Blog </span> </a>  </div> <div class="sl-flex astro-3yejb74e"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-3f6z2m2q"> <button data-open-modal disabled class="astro-3f6z2m2q">  <svg aria-label="Search" class="astro-3f6z2m2q astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-3f6z2m2q" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-3f6z2m2q astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-3f6z2m2q"> <div class="dialog-frame sl-flex astro-3f6z2m2q">  <button data-close-modal class="sl-flex md:sl-hidden astro-3f6z2m2q"> Cancel </button> <div class="search-container astro-3f6z2m2q"> <div id="starlight__search" class="astro-3f6z2m2q"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-3yejb74e"> <div class="sl-flex social-icons astro-3yejb74e"> <a href="//ascii.lnear.dev" class=" astro-lifumyle">ascii.
</a><a href="//blog.lnear.dev" class="active astro-lifumyle">blog.
</a><a href="//docs.lnear.dev" class=" astro-lifumyle">docs.
</a><a href="//shuffle.lnear.dev" class=" astro-lifumyle">shuffle.
</a> <a href="https://github.com/lnear-dev/" rel="me" class="sl-flex astro-2nug3y5c"><span class="sr-only astro-2nug3y5c">GitHub</span><svg aria-hidden="true" class="astro-2nug3y5c astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a><a href="https://twitter.com/lnearwaju" rel="me" class="sl-flex astro-2nug3y5c"><span class="sr-only astro-2nug3y5c">Twitter</span><svg aria-hidden="true" class="astro-2nug3y5c astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M24 4.4a10 10 0 0 1-2.83.78 5.05 5.05 0 0 0 2.17-2.79 9.7 9.7 0 0 1-3.13 1.23 4.89 4.89 0 0 0-5.94-1.03 5 5 0 0 0-2.17 2.38 5.15 5.15 0 0 0-.3 3.25c-1.95-.1-3.86-.63-5.61-1.53a14.04 14.04 0 0 1-4.52-3.74 5.2 5.2 0 0 0-.09 4.91c.39.74.94 1.35 1.61 1.82a4.77 4.77 0 0 1-2.23-.63v.06c0 1.16.4 2.29 1.12 3.18a4.9 4.9 0 0 0 2.84 1.74c-.73.22-1.5.26-2.24.12a4.89 4.89 0 0 0 4.59 3.49A9.78 9.78 0 0 1 0 19.73 13.65 13.65 0 0 0 7.55 22a13.63 13.63 0 0 0 9.96-4.16A14.26 14.26 0 0 0 21.6 7.65V7c.94-.72 1.75-1.6 2.4-2.6Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-c75cuvm3"> <span class="sr-only astro-c75cuvm3">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-c75cuvm3 astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-c75cuvm3"> <option value="dark" class="astro-c75cuvm3">Dark</option><option value="light" class="astro-c75cuvm3">Light</option><option value="auto" selected="true" class="astro-c75cuvm3">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-c75cuvm3 astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-hktxvhte" aria-label="Main"> <starlight-menu-button class="astro-3ohjhgor"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-3ohjhgor"> <svg aria-hidden="true" class="astro-3ohjhgor astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-hktxvhte"> <div class="sidebar-content sl-flex astro-hktxvhte"> <ul class="top-level astro-ehd5n5ys"> <li class="astro-ehd5n5ys"> <details open class="astro-ehd5n5ys"> <summary class="astro-ehd5n5ys"> <div class="group-label astro-ehd5n5ys"> <span class="large astro-ehd5n5ys">Posts</span>  </div> <svg aria-hidden="true" class="caret astro-ehd5n5ys astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-ehd5n5ys"> <li class="astro-ehd5n5ys"> <a href="/advanced-graphql-schema-design/" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">Advanced GraphQL Schema Design: A Deep Dive into Financial Trading Platform Architecture</span>  </a> </li><li class="astro-ehd5n5ys"> <a href="/exploring-recursive-backtracking-a-powerful-technique-for-problem-solving/" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">Exploring Recursive Backtracking: A Powerful Technique for Problem Solving</span>  </a> </li><li class="astro-ehd5n5ys"> <a href="/mastering-object-oriented-programming/" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">Mastering Object-Oriented Programming: A Comprehensive Guide</span>  </a> </li><li class="astro-ehd5n5ys"> <a href="/raii-in-php/" aria-current="page" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">RAII in PHP: Managing Resources Elegantly</span>  </a> </li><li class="astro-ehd5n5ys"> <a href="/why-your-css-framework-is-failing-you/" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">Why Your CSS Framework is Failing You</span>  </a> </li> </ul>  </details> </li><li class="astro-ehd5n5ys"> <details open class="astro-ehd5n5ys"> <summary class="astro-ehd5n5ys"> <div class="group-label astro-ehd5n5ys"> <span class="large astro-ehd5n5ys">News</span>  </div> <svg aria-hidden="true" class="caret astro-ehd5n5ys astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-ehd5n5ys"> <li class="astro-ehd5n5ys"> <a href="/introducing-lnear-cache-efficient-caching-for-typescript/" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">Introducing @lnear/cache: Efficient Caching for TypeScript</span>  </a> </li><li class="astro-ehd5n5ys"> <a href="/this-is-perhaps/" class="astro-ehd5n5ys"> <span class="astro-ehd5n5ys">This is Perhaps</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-37azxbnv"> <div class="sl-flex social-icons astro-37azxbnv"> <a href="//ascii.lnear.dev" class=" astro-lifumyle">ascii.
</a><a href="//blog.lnear.dev" class="active astro-lifumyle">blog.
</a><a href="//docs.lnear.dev" class=" astro-lifumyle">docs.
</a><a href="//shuffle.lnear.dev" class=" astro-lifumyle">shuffle.
</a> <a href="https://github.com/lnear-dev/" rel="me" class="sl-flex astro-2nug3y5c"><span class="sr-only astro-2nug3y5c">GitHub</span><svg aria-hidden="true" class="astro-2nug3y5c astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a><a href="https://twitter.com/lnearwaju" rel="me" class="sl-flex astro-2nug3y5c"><span class="sr-only astro-2nug3y5c">Twitter</span><svg aria-hidden="true" class="astro-2nug3y5c astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M24 4.4a10 10 0 0 1-2.83.78 5.05 5.05 0 0 0 2.17-2.79 9.7 9.7 0 0 1-3.13 1.23 4.89 4.89 0 0 0-5.94-1.03 5 5 0 0 0-2.17 2.38 5.15 5.15 0 0 0-.3 3.25c-1.95-.1-3.86-.63-5.61-1.53a14.04 14.04 0 0 1-4.52-3.74 5.2 5.2 0 0 0-.09 4.91c.39.74.94 1.35 1.61 1.82a4.77 4.77 0 0 1-2.23-.63v.06c0 1.16.4 2.29 1.12 3.18a4.9 4.9 0 0 0 2.84 1.74c-.73.22-1.5.26-2.24.12a4.89 4.89 0 0 0 4.59 3.49A9.78 9.78 0 0 1 0 19.73 13.65 13.65 0 0 0 7.55 22a13.63 13.63 0 0 0 9.96-4.16A14.26 14.26 0 0 0 21.6 7.65V7c.94-.72 1.75-1.6 2.4-2.6Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-c75cuvm3"> <span class="sr-only astro-c75cuvm3">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-c75cuvm3 astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-c75cuvm3"> <option value="dark" class="astro-c75cuvm3">Dark</option><option value="light" class="astro-c75cuvm3">Light</option><option value="auto" selected="true" class="astro-c75cuvm3">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-c75cuvm3 astro-bfcktsqv" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-hktxvhte">  <div class="lg:sl-flex astro-gvmk3kpb"> <aside class="right-sidebar-container astro-gvmk3kpb"> <div class="right-sidebar astro-gvmk3kpb"> <div class="lg:sl-hidden astro-rfqaiwpu"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-vj3wodfd"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-vj3wodfd"><details id="starlight__mobile-toc" class="astro-vj3wodfd"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-vj3wodfd"><div class="toggle sl-flex astro-vj3wodfd">On this page<svg aria-hidden="true" class="caret astro-vj3wodfd astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-vj3wodfd"></span></summary><div class="dropdown astro-vj3wodfd"><ul class="isMobile astro-wxoaiqhb" style="--depth: 0;"> <li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#_top" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#understanding-raii-a-deep-dive" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Understanding RAII: A Deep Dive</span> </a> <ul class="isMobile astro-wxoaiqhb" style="--depth: 1;"> <li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#the-three-pillars-of-raii" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">The Three Pillars of RAII</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#why-raii-matters" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">Why RAII Matters</span> </a>  </li> </ul>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#applying-raii-principles-in-php" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Applying RAII Principles in PHP</span> </a> <ul class="isMobile astro-wxoaiqhb" style="--depth: 1;"> <li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#1-leveraging-constructors-and-destructors" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">1. Leveraging Constructors and Destructors</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#2-implementing-the-__invoke-method-for-scoped-operations" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">2. Implementing the __invoke Method for Scoped Operations</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#3-utilizing-try-finally-blocks-for-manual-resource-management" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">3. Utilizing try-finally Blocks for Manual Resource Management</span> </a>  </li> </ul>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#benefits-of-raii-like-patterns-in-php" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Benefits of RAII-like Patterns in PHP</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#considerations-and-limitations" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Considerations and Limitations</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#conclusion" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Conclusion</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-rfqaiwpu"><div class="sl-container astro-rfqaiwpu"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-wxoaiqhb" style="--depth: 0;"> <li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#_top" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#understanding-raii-a-deep-dive" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Understanding RAII: A Deep Dive</span> </a> <ul class="astro-wxoaiqhb" style="--depth: 1;"> <li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#the-three-pillars-of-raii" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">The Three Pillars of RAII</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#why-raii-matters" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">Why RAII Matters</span> </a>  </li> </ul>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#applying-raii-principles-in-php" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Applying RAII Principles in PHP</span> </a> <ul class="astro-wxoaiqhb" style="--depth: 1;"> <li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#1-leveraging-constructors-and-destructors" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">1. Leveraging Constructors and Destructors</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#2-implementing-the-__invoke-method-for-scoped-operations" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">2. Implementing the __invoke Method for Scoped Operations</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 1;"> <a href="#3-utilizing-try-finally-blocks-for-manual-resource-management" class="astro-wxoaiqhb" style="--depth: 1;"> <span class="astro-wxoaiqhb" style="--depth: 1;">3. Utilizing try-finally Blocks for Manual Resource Management</span> </a>  </li> </ul>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#benefits-of-raii-like-patterns-in-php" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Benefits of RAII-like Patterns in PHP</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#considerations-and-limitations" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Considerations and Limitations</span> </a>  </li><li class="astro-wxoaiqhb" style="--depth: 0;"> <a href="#conclusion" class="astro-wxoaiqhb" style="--depth: 0;"> <span class="astro-wxoaiqhb" style="--depth: 0;">Conclusion</span> </a>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-gvmk3kpb">  <main data-pagefind-body lang="en" dir="ltr" class="astro-z2rwgm2f">    <div class="content-panel astro-h73cpsq2"> <div class="sl-container astro-h73cpsq2"> <h1 id="_top" class="astro-vmgva5wp">RAII in PHP: Managing Resources Elegantly</h1>  </div> </div>  <div class="content-panel astro-h73cpsq2"> <div class="sl-container astro-h73cpsq2"> <div class="sl-markdown-content"> <p>In the world of software development, efficient resource management is crucial for creating robust and reliable applications. One powerful paradigm for handling resources is Resource Acquisition Is Initialization (RAII). While this concept originated in C++, its principles can be applied to other languages, including PHP. In this blog post, we’ll dive deep into RAII, explore its application in PHP, and examine how it can elevate your code quality.</p>
<h2 id="understanding-raii-a-deep-dive">Understanding RAII: A Deep Dive</h2>
<p>Resource Acquisition Is Initialization (RAII) is more than just a catchy acronym; it’s a design pattern that fundamentally changes how we think about resource management. At its core, RAII ties the lifecycle of a resource to the lifetime of an object. This simple yet powerful idea has far-reaching implications for code structure, reliability, and maintainability.</p>
<h3 id="the-three-pillars-of-raii">The Three Pillars of RAII</h3>
<ol>
<li>
<p><strong>Acquire resources in the constructor</strong>: When an object is created, it should immediately acquire any resources it needs. This ensures that the object is always in a valid state from the moment it comes into existence.</p>
</li>
<li>
<p><strong>Release resources in the destructor</strong>: As the object’s life comes to an end, it should release all the resources it acquired. This automatic cleanup reduces the risk of resource leaks.</p>
</li>
<li>
<p><strong>Use stack-allocated objects to manage resources</strong>: By leveraging the predictable lifetime of stack-allocated objects, we can ensure that resources are released in a deterministic order, even in the face of exceptions.</p>
</li>
</ol>
<h3 id="why-raii-matters">Why RAII Matters</h3>
<p>RAII addresses several critical issues in software development:</p>
<ul>
<li><strong>Resource Leaks</strong>: By automatically managing resource lifetimes, RAII significantly reduces the risk of resource leaks, a common source of bugs and performance issues.</li>
<li><strong>Exception Safety</strong>: RAII ensures proper cleanup even when exceptions occur, making your code more robust in the face of errors.</li>
<li><strong>Simplified Mental Model</strong>: Developers can reason about resource usage more easily when it’s tied directly to object lifetimes.</li>
<li><strong>Reduced Boilerplate</strong>: RAII eliminates much of the repetitive cleanup code that often clutters codebases.</li>
</ul>
<h2 id="applying-raii-principles-in-php">Applying RAII Principles in PHP</h2>
<p>In PHP, the destructor is be called as soon as there are no other references to a particular object, or in any order during the shutdown sequence. This means that PHP doesn’t provide the same level of determinism as C++ when it comes to resource management. However, we can still apply RAII-like patterns in PHP to achieve similar benefits. Let’s explore several techniques and patterns that bring RAII-like benefits to PHP.</p>
<h3 id="1-leveraging-constructors-and-destructors">1. Leveraging Constructors and Destructors</h3>
<p>PHP’s object-oriented features allow us to use constructors and destructors to manage resource lifecycles. Here’s an expanded example of a database connection class that demonstrates this principle:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.jckaa.css"><script type="module" src="/_astro/ec.3zb7u.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#8D46B4">&#x3C;?</span><span style="--0:#C99076;--1:#3C63B3">php</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#8D46B4">class</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#5DA994;--1:#111111">DatabaseConnection</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">PDO</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">connection</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">int</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">queryCount</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">0</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">string</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lastQuery</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">''</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">__construct</span><span style="--0:#838383;--1:#111111">(</span><span style="--0:#4D9375;--1:#8D46B4">string</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">host</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#4D9375;--1:#8D46B4">string</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">user</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#4D9375;--1:#8D46B4">string</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">pass</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#4D9375;--1:#8D46B4">string</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">db</span><span style="--0:#838383">)</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">dsn</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">mysql:host=</span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#C98A7D">host</span></span><span style="--0:#C98A7D;--1:#9B504E">;dbname=</span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#C98A7D">db</span></span><span style="--0:#C98A7D;--1:#9B504E">;charset=utf8mb4</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">try</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">connection</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#097174">new</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">PDO</span><span style="--0:#838383;--1:#403F53">(</span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">dsn</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">user</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">pass</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">[</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#B8A965;--1:#3C63B3">PDO</span><span style="--0:#CB7676;--1:#097174">::</span><span style="--0:#C99076;--1:#3C63B3">ATTR_ERRMODE</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">=></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">PDO</span><span style="--0:#CB7676;--1:#097174">::</span><span style="--0:#C99076;--1:#3C63B3">ERRMODE_EXCEPTION</span><span style="--0:#838383;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#B8A965;--1:#3C63B3">PDO</span><span style="--0:#CB7676;--1:#097174">::</span><span style="--0:#C99076;--1:#3C63B3">ATTR_DEFAULT_FETCH_MODE</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">=></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">PDO</span><span style="--0:#CB7676;--1:#097174">::</span><span style="--0:#C99076;--1:#3C63B3">FETCH_ASSOC</span><span style="--0:#838383;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">            </span></span><span style="--0:#838383;--1:#403F53">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#B8A965;--1:#3C63B3">error_log</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Database connection established</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">catch</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#111111">(</span><span style="--0:#B8A965;--1:#3C63B3">PDOException</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">e</span><span style="--0:#838383">)</span></span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#8D46B4">throw</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#097174">new</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">Exception</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Connection failed: </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">e</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">getMessage</span><span style="--0:#838383;--1:#403F53">());</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">__destruct</span><span style="--0:#838383;--1:#111111">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">unset</span><span style="--0:#838383;--1:#403F53">($</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">connection</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">error_log</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Database connection closed. Total queries executed: </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#C98A7D;--1:#111111">queryCount</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">query</span><span style="--0:#838383;--1:#111111">(</span><span style="--0:#4D9375;--1:#8D46B4">string</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">sql</span><span style="--0:#838383">)</span></span><span style="--0:#CB7676;--1:#097174">:</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">PDOStatement</span><span style="--0:#838383;--1:#403F53">|</span><span style="--0:#4D9375;--1:#8D46B4">false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lastQuery</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">sql</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">queryCount</span><span style="--0:#CB7676;--1:#097174">++</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">return</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">connection</span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">query</span><span style="--0:#838383;--1:#403F53">(</span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">sql</span></span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">getLastQuery</span><span style="--0:#838383;--1:#111111">()</span><span style="--0:#CB7676;--1:#097174">:</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">string</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">return</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lastQuery</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">getQueryCount</span><span style="--0:#838383;--1:#111111">()</span><span style="--0:#CB7676;--1:#097174">:</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">int</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">return</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">queryCount</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#778777FE;--1:#5E6578">// Usage</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">performDatabaseOperations</span><span style="--0:#838383;--1:#111111">()</span><span style="--0:#CB7676;--1:#097174">:</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">void</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">db</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#097174">new</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#111111">DatabaseConnection</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">localhost</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">user</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">password</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">mydb</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">db</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">query</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#4D9375;--1:#8D46B4">SELECT</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#CB7676;--1:#097174">*</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">FROM</span><span style="--0:#C98A7D;--1:#9B504E"> users</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">foreach</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">as</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">row</span></span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#778777FE;--1:#5E6578">// Process each row...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">db</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">query</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#4D9375;--1:#8D46B4">UPDATE</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">stats</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">SET</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">value</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#CB7676;--1:#8D46B4">=</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">value</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#CB7676;--1:#097174">+</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4C9A91;--1:#AA0982">1</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">WHERE</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#4D9375;--1:#8D46B4">name</span><span style="--0:#C98A7D;--1:#9B504E"> </span><span style="--0:#CB7676;--1:#8D46B4">=</span><span style="--0:#C98A7D;--1:#9B504E"> 'visits'</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#B8A965;--1:#3C63B3">echo</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Last query executed: </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">db</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">getLastQuery</span><span style="--1:#403F53"><span style="--0:#838383">()</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C99076;--1:#AA0982">\n</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#B8A965;--1:#3C63B3">echo</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Total queries: </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">db</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">getQueryCount</span><span style="--1:#403F53"><span style="--0:#838383">()</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C99076;--1:#AA0982">\n</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#778777FE;--1:#5E6578">// No need to manually close the connection</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#3C63B3">performDatabaseOperations</span><span style="--0:#838383;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#778777FE;--1:#5E6578">// Database connection will be automatically closed when $db goes out of scope</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<?phpclass DatabaseConnection{    private PDO $connection;    private int $queryCount = 0;    private string $lastQuery = &#x27;&#x27;;    public function __construct(string $host, string $user, string $pass, string $db)    {        $dsn = &#x22;mysql:host=$host;dbname=$db;charset=utf8mb4&#x22;;        try {            $this->connection = new PDO($dsn, $user, $pass, [                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,            ]);            error_log(&#x22;Database connection established&#x22;);        } catch (PDOException $e) {            throw new Exception(&#x22;Connection failed: &#x22; . $e->getMessage());        }    }    public function __destruct()    {        unset($this->connection);        error_log(&#x22;Database connection closed. Total queries executed: {$this->queryCount}&#x22;);    }    public function query(string $sql): PDOStatement|false    {        $this->lastQuery = $sql;        $this->queryCount++;        return $this->connection->query($sql);    }    public function getLastQuery(): string    {        return $this->lastQuery;    }    public function getQueryCount(): int    {        return $this->queryCount;    }}// Usagefunction performDatabaseOperations(): void{    $db = new DatabaseConnection(&#x22;localhost&#x22;, &#x22;user&#x22;, &#x22;password&#x22;, &#x22;mydb&#x22;);    $result = $db->query(&#x22;SELECT * FROM users&#x22;);    if ($result) {        foreach ($result as $row) {            // Process each row...        }    }    $db->query(&#x22;UPDATE stats SET value = value + 1 WHERE name = &#x27;visits&#x27;&#x22;);    echo &#x22;Last query executed: &#x22; . $db->getLastQuery() . &#x22;\n&#x22;;    echo &#x22;Total queries: &#x22; . $db->getQueryCount() . &#x22;\n&#x22;;    // No need to manually close the connection}performDatabaseOperations();// Database connection will be automatically closed when $db goes out of scope"><div></div></button></div></figure></div>
<p>In this example, the <code dir="auto">DatabaseConnection</code> class acquires a database connection in the constructor and releases it in the destructor. This ensures that the connection is always properly closed, even if an exception occurs during database operations. By encapsulating resource management within the object, we create a cleaner, more reliable way to interact with the database.</p>
<h3 id="2-implementing-the-__invoke-method-for-scoped-operations">2. Implementing the <code dir="auto">__invoke</code> Method for Scoped Operations</h3>
<p>PHP’s <code dir="auto">__invoke</code> method allows objects to be called as functions. We can use this feature to create RAII-like patterns for scoped operations. Here’s an advanced example using a file locking mechanism:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#8D46B4">class</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#5DA994;--1:#111111">FileLock</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lockFile</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">resourceName</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lockAcquired</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#3C63B3">false</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">private</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">operationsPerformed</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">0</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">__construct</span><span style="--1:#111111"><span style="--0:#838383">($</span><span style="--0:#BD976A">resourceName</span><span style="--0:#838383">)</span></span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">resourceName</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">resourceName</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lockFile</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">fopen</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">/tmp/</span><span style="--0:#838383;--1:#403F53">{$</span><span style="--0:#C98A7D;--1:#111111">resourceName</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7D;--1:#9B504E">.lock</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#C98A7D;--1:#9B504E">w</span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">__destruct</span><span style="--0:#838383;--1:#111111">()</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lockAcquired</span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#B8A965;--1:#3C63B3">flock</span><span style="--0:#838383;--1:#403F53">($</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lockFile</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C99076;--1:#097174">LOCK_UN</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#B8A965;--1:#3C63B3">error_log</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Lock released for </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#C98A7D;--1:#111111">resourceName</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7D;--1:#9B504E">. Operations performed: </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#C98A7D;--1:#111111">operationsPerformed</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">fclose</span><span style="--0:#838383;--1:#403F53">($</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lockFile</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">__invoke</span><span style="--0:#838383;--1:#111111">(</span><span style="--0:#4D9375;--1:#8D46B4">callable</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">callback</span><span style="--0:#838383">)</span></span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--0:#CB7676;--1:#8D46B4">!</span><span style="--0:#B8A965;--1:#3C63B3">flock</span><span style="--0:#838383;--1:#403F53">($</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lockFile</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C99076;--1:#097174">LOCK_EX</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#CB7676;--1:#8D46B4">|</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C99076;--1:#097174">LOCK_NB</span><span style="--1:#403F53"><span style="--0:#838383">))</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#8D46B4">throw</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#097174">new</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">Exception</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--1:#9B504E"><span style="--0:#C98A7D">Unable to acquire lock for </span><span style="--0:#838383">{</span></span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#C98A7D;--1:#111111">resourceName</span><span style="--0:#838383;--1:#9B504E">}</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">lockAcquired</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#3C63B3">true</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">error_log</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Lock acquired for </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#C98A7D;--1:#111111">resourceName</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">try</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">callback</span></span><span style="--0:#838383;--1:#403F53">(</span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span></span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#8D46B4">return</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">finally</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#778777FE;--1:#5E6578">// Lock will be released in the destructor</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CB7676;--1:#8D46B4">public</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">performOperation</span><span style="--1:#111111"><span style="--0:#838383">($</span><span style="--0:#BD976A">description</span><span style="--0:#838383">)</span></span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#097174"><span style="--0:#838383">$</span><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#BD976A;--1:#111111">operationsPerformed</span><span style="--0:#CB7676;--1:#097174">++</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">error_log</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Performing operation on </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--1:#097174"><span style="--0:#C99076">this</span><span style="--0:#CB7676">-></span></span><span style="--0:#C98A7D;--1:#111111">resourceName</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7D;--1:#9B504E">: </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--0:#C98A7D;--1:#111111">description</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#778777FE;--1:#5E6578">// Simulate some work</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">usleep</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#B8A965;--1:#3C63B3">mt_rand</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#4C9A91;--1:#AA0982">100000</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#4C9A91;--1:#AA0982">500000</span><span style="--0:#838383;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#778777FE;--1:#5E6578">// Usage</span></div></div><div class="ec-line"><div class="code"><span style="--0:#4D9375;--1:#8D46B4">try</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lock</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#097174">new</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#111111">FileLock</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#C98A7D;--1:#9B504E">important_resource</span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lock</span></span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--1:#111111"><span style="--0:#838383">($</span><span style="--0:#BD976A">lockObj</span><span style="--0:#838383">)</span></span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lockObj</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">performOperation</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Step 1</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lockObj</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">performOperation</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Step 2</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--0:#B8A965;--1:#3C63B3">mt_rand</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#4C9A91;--1:#AA0982">0</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#4C9A91;--1:#AA0982">1</span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#CB7676;--1:#8D46B4">==</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">1</span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#8D46B4">throw</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#097174">new</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">Exception</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Random failure</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lockObj</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">performOperation</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Step 3</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">return</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Operation complete</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#B8A965;--1:#3C63B3">echo</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C99076;--1:#AA0982">\n</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--1:#403F53"><span style="--0:#838383">}</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#4D9375;--1:#8D46B4">catch</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#111111">(</span><span style="--0:#B8A965;--1:#3C63B3">Exception</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">e</span><span style="--0:#838383">)</span></span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#B8A965;--1:#3C63B3">echo</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">An error occurred: </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">e</span></span><span style="--0:#CB7676;--1:#097174">-></span><span style="--0:#80A665;--1:#3C63B3">getMessage</span><span style="--1:#403F53"><span style="--0:#838383">()</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C99076;--1:#AA0982">\n</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#778777FE;--1:#5E6578">// Lock is automatically released, even if an exception occurred</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class FileLock {    private $lockFile;    private $resourceName;    private $lockAcquired = false;    private $operationsPerformed = 0;    public function __construct($resourceName) {        $this->resourceName = $resourceName;        $this->lockFile = fopen(&#x22;/tmp/{$resourceName}.lock&#x22;, &#x27;w&#x27;);    }    public function __destruct() {        if ($this->lockAcquired) {            flock($this->lockFile, LOCK_UN);            error_log(&#x22;Lock released for {$this->resourceName}. Operations performed: {$this->operationsPerformed}&#x22;);        }        fclose($this->lockFile);    }    public function __invoke(callable $callback) {        if (!flock($this->lockFile, LOCK_EX | LOCK_NB)) {            throw new Exception(&#x22;Unable to acquire lock for {$this->resourceName}&#x22;);        }        $this->lockAcquired = true;        error_log(&#x22;Lock acquired for {$this->resourceName}&#x22;);        try {            $result = $callback($this);            return $result;        } finally {            // Lock will be released in the destructor        }    }    public function performOperation($description) {        $this->operationsPerformed++;        error_log(&#x22;Performing operation on {$this->resourceName}: {$description}&#x22;);        // Simulate some work        usleep(mt_rand(100000, 500000));    }}// Usagetry {    $lock = new FileLock(&#x27;important_resource&#x27;);    $result = $lock(function($lockObj) {        $lockObj->performOperation(&#x22;Step 1&#x22;);        $lockObj->performOperation(&#x22;Step 2&#x22;);        if (mt_rand(0, 1) == 1) {            throw new Exception(&#x22;Random failure&#x22;);        }        $lockObj->performOperation(&#x22;Step 3&#x22;);        return &#x22;Operation complete&#x22;;    });    echo $result . &#x22;\n&#x22;;} catch (Exception $e) {    echo &#x22;An error occurred: &#x22; . $e->getMessage() . &#x22;\n&#x22;;}// Lock is automatically released, even if an exception occurred"><div></div></button></div></figure></div>
<p>This pattern ensures that the lock is always released, even if an exception is thrown during the operation. It also provides a clean, expressive way to perform locked operations.</p>
<h3 id="3-utilizing-try-finally-blocks-for-manual-resource-management">3. Utilizing <code dir="auto">try</code>-<code dir="auto">finally</code> Blocks for Manual Resource Management</h3>
<p>For resources that require manual management, <code dir="auto">try</code>-<code dir="auto">finally</code> blocks offer a way to ensure cleanup. Here’s an expanded example that processes a large file while providing progress updates:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="php"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">processLargeFile</span><span style="--1:#111111"><span style="--0:#838383">($</span><span style="--0:#BD976A">filename</span></span><span style="--1:#403F53"><span style="--0:#838383">,</span><span style="--0:#DBD7CACC"> </span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">progressCallback</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#3C63B3">null</span><span style="--0:#838383;--1:#111111">)</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">file</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">fopen</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">filename</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#C98A7D;--1:#9B504E">r</span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lineCount</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">0</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">totalLines</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">trim</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#B8A965;--1:#3C63B3">shell_exec</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">wc -l </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--1:#3C63B3"><span style="--0:#DBD7CACC"> </span><span style="--0:#B8A965">escapeshellarg</span></span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">filename</span><span style="--1:#403F53"><span style="--0:#838383">)))</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#CB7676;--1:#097174">??</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">0</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#8D46B4">try</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">while</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--0:#CB7676;--1:#8D46B4">!</span><span style="--0:#B8A965;--1:#3C63B3">feof</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">file</span><span style="--1:#403F53"><span style="--0:#838383">))</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">line</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">fgets</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">file</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lineCount</span></span><span style="--0:#CB7676;--1:#097174">++</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#778777FE;--1:#5E6578">// Process the line</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">processedLine</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#B8A965;--1:#3C63B3">strtoupper</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#B8A965;--1:#3C63B3">trim</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">line</span><span style="--0:#838383;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#778777FE;--1:#5E6578">// Perform some operation with the processed line</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#778777FE;--1:#5E6578">// For example, write to another file or database</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#778777FE;--1:#5E6578">// Update progress</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#8D46B4">if</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">progressCallback</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">&#x26;&#x26;</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lineCount</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">%</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">1000</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">==</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">0</span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">progress</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">(</span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lineCount</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#CB7676;--1:#8D46B4">/</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">totalLines</span></span><span style="--1:#403F53"><span style="--0:#838383">)</span><span style="--0:#DBD7CACC"> </span></span><span style="--0:#CB7676;--1:#8D46B4">*</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4C9A91;--1:#AA0982">100</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">progressCallback</span></span><span style="--0:#838383;--1:#403F53">(</span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">progress</span></span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">            </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">        </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#8D46B4">return</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">lineCount</span></span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#4D9375;--1:#8D46B4">finally</span><span style="--1:#403F53"><span style="--0:#DBD7CACC"> </span><span style="--0:#838383">{</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">fclose</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">file</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#B8A965;--1:#3C63B3">error_log</span><span style="--0:#838383;--1:#403F53">(</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">File processing complete. Lines processed: </span><span style="--0:#838383;--1:#403F53">{$</span><span style="--0:#C98A7D;--1:#111111">lineCount</span><span style="--0:#838383;--1:#403F53">}</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#778777FE;--1:#5E6578">// Usage</span></div></div><div class="ec-line"><div class="code"><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">filename</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#C98A7D;--1:#9B504E">very_large_file.txt</span><span style="--0:#C98A7DD9;--1:#111111">'</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#BD976A">result</span></span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#838383;--1:#8D46B4">=</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#80A665;--1:#3C63B3">processLargeFile</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">filename</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#CB7676;--1:#8D46B4">function</span><span style="--0:#838383;--1:#111111">(</span><span style="--0:#838383;--1:#403F53">$</span><span style="--1:#111111"><span style="--0:#BD976A">progress</span><span style="--0:#838383">)</span></span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#838383;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#3C63B3">    </span></span><span style="--0:#B8A965;--1:#3C63B3">echo</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">Processing progress: </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#B8A965;--1:#3C63B3">number_format</span><span style="--0:#838383;--1:#403F53">($</span><span style="--0:#BD976A;--1:#111111">progress</span><span style="--0:#838383;--1:#403F53">,</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#4C9A91;--1:#AA0982">2</span><span style="--0:#838383;--1:#403F53">)</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#CB7676;--1:#097174">.</span><span style="--0:#DBD7CACC;--1:#3C63B3"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#C98A7D;--1:#9B504E">%</span><span style="--0:#C99076;--1:#AA0982">\n</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#838383;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B8A965;--1:#3C63B3">echo</span><span style="--0:#DBD7CACC;--1:#403F53"> </span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--1:#9B504E"><span style="--0:#C98A7D">Total lines processed: </span><span style="--0:#838383">{</span></span><span style="--1:#111111"><span style="--0:#838383">$</span><span style="--0:#C98A7D">result</span></span><span style="--0:#838383;--1:#9B504E">}</span><span style="--0:#C99076;--1:#AA0982">\n</span><span style="--0:#C98A7DD9;--1:#111111">"</span><span style="--0:#838383;--1:#403F53">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function processLargeFile($filename, $progressCallback = null) {    $file = fopen($filename, &#x27;r&#x27;);    $lineCount = 0;    $totalLines = trim(shell_exec(&#x22;wc -l &#x22; . escapeshellarg($filename))) ?? 0;    try {        while (!feof($file)) {            $line = fgets($file);            $lineCount++;            // Process the line            $processedLine = strtoupper(trim($line));            // Perform some operation with the processed line            // For example, write to another file or database            // Update progress            if ($progressCallback &#x26;&#x26; $lineCount % 1000 == 0) {                $progress = ($lineCount / $totalLines) * 100;                $progressCallback($progress);            }        }        return $lineCount;    } finally {        fclose($file);        error_log(&#x22;File processing complete. Lines processed: {$lineCount}&#x22;);    }}// Usage$filename = &#x27;very_large_file.txt&#x27;;$result = processLargeFile($filename, function($progress) {    echo &#x22;Processing progress: &#x22; . number_format($progress, 2) . &#x22;%\n&#x22;;});echo &#x22;Total lines processed: {$result}\n&#x22;;"><div></div></button></div></figure></div>
<p>This approach guarantees that the file is closed, regardless of whether an exception occurs during processing. It also demonstrates how to provide progress updates for long-running operations, making it more suitable for production environments.</p>
<h2 id="benefits-of-raii-like-patterns-in-php">Benefits of RAII-like Patterns in PHP</h2>
<p>By applying these RAII-inspired patterns in PHP, you can reap numerous benefits:</p>
<ol>
<li>
<p><strong>Reduced Risk of Resource Leaks</strong>: By tying resource management to object lifetimes, you minimize the chances of forgetting to release resources.</p>
</li>
<li>
<p><strong>Improved Code Readability and Maintainability</strong>: RAII patterns often lead to cleaner, more organized code structures. Resource management becomes an integral part of your objects, rather than scattered cleanup code.</p>
</li>
<li>
<p><strong>Enhanced Exception Safety</strong>: Proper resource management even in the face of exceptions leads to more robust applications.</p>
</li>
<li>
<p><strong>Simplified Resource Management in Complex Applications</strong>: As applications grow in complexity, RAII-like patterns help maintain control over resources, preventing issues that could otherwise be hard to track down.</p>
</li>
<li>
<p><strong>Better Separation of Concerns</strong>: By encapsulating resource management within objects, you can separate it from business logic, leading to more modular and testable code.</p>
</li>
<li>
<p><strong>Automatic Cleanup</strong>: Developers don’t need to remember to manually release resources, reducing cognitive load and potential for errors.</p>
</li>
</ol>
<h2 id="considerations-and-limitations">Considerations and Limitations</h2>
<p>While these patterns bring many benefits, it’s important to be aware of some limitations when applying RAII-like concepts in PHP:</p>
<ul>
<li><strong>Garbage Collection Timing</strong>: PHP’s garbage collector may not immediately destroy objects when they go out of scope, which can delay resource release.</li>
<li><strong>Circular References</strong>: Be cautious of circular references between objects, as they can prevent timely destruction.</li>
<li><strong>Resource Intensity</strong>: For very resource-intensive operations, manual control might still be necessary in some cases.</li>
<li><strong>Performance Overhead</strong>: Creating objects for short-lived operations might introduce some performance overhead, though this is often negligible compared to the benefits.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>While PHP may not support RAII natively in the same way as C++, adopting these patterns can significantly improve your code quality, reliability, and maintainability. By thinking in terms of resource lifecycles and leveraging PHP’s object-oriented features, you can write more robust code that’s less prone to resource-related bugs.</p>
<p>Remember, the key is to tie resource management to object lifetimes and to use language constructs that ensure proper cleanup. As you incorporate these patterns into your PHP projects, you’ll likely find that your code becomes cleaner, more predictable, and easier to reason about.</p>
<p>In the ever-evolving landscape of PHP development, embracing RAII-like patterns is a step towards writing more professional, reliable, and maintainable code. So the next time you’re dealing with resources in PHP, consider how you can apply these principles to elevate your code quality.</p> </div> <footer class="sl-flex astro-34w5tuhd"> <div class="meta sl-flex astro-34w5tuhd">   </div> <div class="pagination-links astro-al52inl5" dir="ltr"> <a href="/mastering-object-oriented-programming/" rel="prev" class="astro-al52inl5"> <svg aria-hidden="true" class="astro-al52inl5 astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-al52inl5"> Previous <br class="astro-al52inl5"> <span class="link-title astro-al52inl5">Mastering Object-Oriented Programming: A Comprehensive Guide</span> </span> </a> <a href="/why-your-css-framework-is-failing-you/" rel="next" class="astro-al52inl5"> <svg aria-hidden="true" class="astro-al52inl5 astro-jtqsxvkc" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-al52inl5"> Next <br class="astro-al52inl5"> <span class="link-title astro-al52inl5">Why Your CSS Framework is Failing You</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>